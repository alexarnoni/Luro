{% extends "base.html" %}

{% block title %}Transactions - Luro{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Transactions</h1>
    <button type="button" class="btn btn-primary" data-toggle-target="#transaction-form" data-toggle-focus="#account_id" aria-controls="transaction-form" aria-expanded="false">
        + Add Transaction
    </button>
</div>

<section id="transaction-form" class="form-card" hidden aria-hidden="true">
    <h2>Add New Transaction</h2>
    <form method="post" action="/transactions">
        <div class="form-group">
            <label for="account_id">Account</label>
            <select id="account_id" name="account_id" required class="form-control" aria-describedby="account-help">
                <option value="">Select an account</option>
                {% for account in accounts %}
                <option value="{{ account.id }}">{{ account.name }}</option>
                {% endfor %}
            </select>
            <span class="form-hint" id="account-help">Escolha a conta onde o lançamento será registrado.</span>
        </div>

        <div class="form-group">
            <label for="transaction_type">Type</label>
            <select id="transaction_type" name="transaction_type" required class="form-control">
                <option value="income">Income</option>
                <option value="expense">Expense</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="amount">Amount</label>
            <input type="number" id="amount" name="amount" step="0.01" min="0" required class="form-control" placeholder="0.00" aria-describedby="amount-help">
            <span class="form-hint" id="amount-help">Informe valores positivos; o tipo define se é despesa ou receita.</span>
        </div>

        <div class="form-group">
            <label for="category">Category</label>
            <input type="text" id="category" name="category" class="form-control" placeholder="e.g., Groceries, Salary" aria-describedby="category-help">
            <span class="form-hint" id="category-help">Categorias ajudam a entender seus gastos. Você pode cadastrá-las depois.</span>
        </div>
        
        <div class="form-group">
            <label for="description">Description</label>
            <input type="text" id="description" name="description" class="form-control" placeholder="Optional description">
        </div>
        
        <div class="form-group">
            <label for="transaction_date">Date</label>
            <input type="datetime-local" id="transaction_date" name="transaction_date" class="form-control">
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Add Transaction</button>
            <button type="button" class="btn btn-secondary" data-close-target="#transaction-form">Cancel</button>
        </div>
    </form>
</section>

<div class="transactions-table">
    {% if transactions %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Account</th>
                <th>Type</th>
                <th>Category</th>
                <th>Description</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for transaction in transactions %}
            <tr>
                <td>{{ transaction.transaction_date.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>{{ transaction.account.name }}</td>
                <td><span class="badge badge-{{ transaction.transaction_type }}">{{ transaction.transaction_type|title }}</span></td>
                <td>{{ transaction.category or '-' }}</td>
                <td>{{ transaction.description or '-' }}</td>
                <td class="{% if transaction.transaction_type == 'income' %}positive{% else %}negative{% endif %}">
                    {% if transaction.transaction_type == 'income' %}+{% else %}-{% endif %}${{ "%.2f"|format(transaction.amount) }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state" role="status" aria-live="polite">
        <span class="empty-state__icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false" role="presentation"><path d="M5 4a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H5Zm0 2h14a1 1 0 0 1 1 1v1H4V7a1 1 0 0 1 1-1Zm-1 4h16v7a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-7Zm5 2v2H6v-2h3Zm5 0v2h-3v-2h3Z"/></svg>
        </span>
        <h2 class="empty-state__title">Nenhuma transação por aqui</h2>
        <p class="empty-state__description">Adicione lançamentos para acompanhar entradas e saídas ou importe um extrato existente.</p>
        <div class="empty-state__actions">
            <button type="button" class="btn btn-primary" data-toggle-target="#transaction-form" data-toggle-focus="#account_id" aria-controls="transaction-form" aria-expanded="false">Adicionar transação</button>
            <a class="btn btn-ghost" href="/transactions" aria-label="Importar lançamentos">Importar CSV/OFX</a>
        </div>
    </div>
    {% endif %}
</div>
{% block extra_js %}
<script src="/static/js/ui.js" defer></script>
{% endblock %}
{% endblock %}
