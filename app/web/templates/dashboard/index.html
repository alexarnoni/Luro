{% extends "base.html" %}

{% block title %}{{ _('Painel - Luro') }}{% endblock %}

{% block content %}
<div class="dashboard" data-dashboard aria-busy="true">
    <div class="dashboard-header">
        <div>
            <h1>{{ _('Olá, %(username)s!') % {'username': (user.name or user.email)} }}</h1>
            <p class="dashboard-subtitle">{{ _('Acompanhe suas finanças e visualize tendências dos últimos meses.') }}</p>
        </div>
        <!-- expose server-side total balance for JS to render "Saldo das contas" card -->
        <div id="page-data" style="display:none;" data-total-balance="{{ total_balance or 0 }}"></div>
        <div class="dashboard-filters">
            <label for="filtro-mes">{{ _('Mês de referência') }}</label>
            <input type="month" id="filtro-mes" name="filtro-mes" class="form-control" />
        </div>
    </div>

    <section class="dashboard-section">
        <div class="section-heading">
            <h2>{{ _('Resumo do mês') }}</h2>
        </div>
        <div class="totals-grid" id="totals-cards" aria-live="polite"></div>
    </section>

    <div class="charts-grid">
        <section class="dashboard-section chart-card">
                <div class="section-heading">
            <h2>{{ _('Despesas por categoria') }}</h2>
            </div>
            <div class="chart-wrapper" data-chart-target="categorias" aria-live="polite"></div>
        </section>
        <section class="dashboard-section chart-card">
            <div class="section-heading">
            <h2>{{ _('Evolução mensal') }}</h2>
            </div>
            <div class="chart-wrapper" data-chart-target="evolucao" aria-live="polite"></div>
        </section>
    </div>

    <section class="dashboard-section">
        <div class="section-heading">
            <h2>{{ _('Insight do mês') }}</h2>
            <div class="section-actions">
                <button
                    type="button"
                    class="btn btn-primary btn-inline"
                    data-insight-action
                    aria-controls="insight-mensal"
                >
                    {{ _('Gerar/Atualizar') }}
                </button>
            </div>
        </div>
        <article
            id="insight-mensal"
            class="insight-card"
            data-insight-card
            aria-busy="false"
        >
            <p class="insight-message" data-insight-text role="status" aria-live="polite"></p>
            <p class="insight-hint">{{ _('Insights gerados por IA. Revise antes de tomar decisões financeiras.') }}</p>
        </article>
    </section>

    <section class="dashboard-section">
        <div class="section-heading">
            <h2>{{ _('Saldos por conta') }}</h2>
        </div>
        <div id="contas-list" class="accounts-list" aria-live="polite"></div>
    </section>

    <section class="dashboard-section danger-zone">
        <div class="section-heading">
            <h2>{{ _('Configurações da conta') }}</h2>
        </div>
        <p>{{ _('Excluir sua conta removerá todos os dados financeiros associados. Esta ação é irreversível.') }}</p>
        <button
            type="button"
            class="btn btn-danger"
            data-delete-account
            aria-controls="delete-account-modal"
        >
            {{ _('Excluir minha conta') }}
        </button>
    </section>

    <noscript>
        <p class="empty-state">{{ _('Ative o JavaScript para visualizar o resumo financeiro.') }}</p>
    </noscript>
</div>
<div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

<div class="modal" id="delete-account-modal" hidden aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-content">
        <h3>{{ _('Excluir conta') }}</h3>
        <p>{{ _('Tem certeza de que deseja excluir sua conta e todos os dados? Esta ação não pode ser desfeita.') }}</p>
        <form id="delete-account-form" method="post" action="/account/delete">
            <div class="modal-actions">
                <button type="submit" class="btn btn-danger">{{ _('Sim, excluir tudo') }}</button>
                <button type="button" class="btn btn-secondary" data-close-target="#delete-account-modal">{{ _('Cancelar') }}</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js" defer></script>
<script src="/static/js/dashboard.js" defer></script>
{% endblock %}
