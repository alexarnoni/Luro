<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ _('Luro - Gerenciador Financeiro Pessoal') }}{% endblock %}</title>
    <link rel="stylesheet" href="/static/css/style.css?v={{ ASSETS_VERSION }}">
    <link rel="icon" href="/static/favicon.ico?v={{ ASSETS_VERSION }}" type="image/x-icon">
    {% block extra_css %}{% endblock %}
</head>
<body data-session-cookie-name="{{ SESSION_COOKIE_NAME }}" data-enable-csrf-json="{{ 'true' if ENABLE_CSRF_JSON else 'false' }}" data-user-authenticated="{{ 'true' if user else 'false' }}">
    <nav class="navbar" data-nav>
        <div class="container">
            <a href="/" class="logo" id="site-logo">Luro</a>
            {% if user %}
            <ul class="nav-links">
                <li><a href="/dashboard">{{ _('Painel') }}</a></li>
                <li><a href="/accounts">{{ _('Contas') }}</a></li>
                <li><a href="/transactions">{{ _('Transações') }}</a></li>
                <li><a href="/goals">{{ _('Metas') }}</a></li>
                {% if is_admin(user) %}
                <li><a href="/admin">{{ _('Admin') }}</a></li>
                {% endif %}
                <li><a href="/logout">{{ _('Sair') }}</a></li>
            </ul>
            {% else %}
            <ul class="nav-links">
                <li><a href="/login">{{ _('Entrar') }}</a></li>
            </ul>
            {% endif %}
            
            <button type="button" class="theme-toggle" data-theme-toggle aria-pressed="false" aria-label="Alternar para tema escuro">
                <span class="theme-toggle__icon" aria-hidden="true">
                    <svg class="theme-toggle__sun" viewBox="0 0 24 24" role="presentation" focusable="false">
                        <path d="M12 4.75a.75.75 0 0 1-.75-.75V2a.75.75 0 0 1 1.5 0v2a.75.75 0 0 1-.75.75Zm0 16a.75.75 0 0 1-.75-.75v-2a.75.75 0 1 1 1.5 0v2a.75.75 0 0 1-.75.75ZM5.28 6.34a.75.75 0 0 1-1.06-1.06l1.42-1.42a.75.75 0 1 1 1.06 1.06L5.28 6.34Zm13.02 12.02a.75.75 0 0 1-1.06-1.06l1.42-1.42a.75.75 0 1 1 1.06 1.06l-1.42 1.42ZM4.75 12a.75.75 0 0 1-.75-.75V9a.75.75 0 0 1 1.5 0v2.25A.75.75 0 0 1 4.75 12Zm16 0a.75.75 0 0 1-.75-.75V9a.75.75 0 0 1 1.5 0v2.25a.75.75 0 0 1-.75.75ZM5.28 17.66 3.86 19.08a.75.75 0 1 1-1.06-1.06l1.42-1.42a.75.75 0 1 1 1.06 1.06Zm13.44-11.32a.75.75 0 0 1-1.06-1.06l1.42-1.42a.75.75 0 1 1 1.06 1.06l-1.42 1.42ZM12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10Z" />
                    </svg>
                    <svg class="theme-toggle__moon" viewBox="0 0 24 24" role="presentation" focusable="false">
                        <path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79Z" />
                    </svg>
                </span>
                <span class="theme-toggle__label" data-theme-toggle-text>{{ _('Modo claro') }}</span>
            </button>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Luro. {{ _('Gerenciamento Financeiro Pessoal') }}.</p>
            <p class="beta-badge">{{ _('Beta público: o Luro está em fase de testes. Feedbacks são bem-vindos!') }}</p>
            <div class="footer-links">
                <a href="mailto:alexandre@alexarnoni.com">{{ _('Enviar feedback') }}</a>
                <span aria-hidden="true">•</span>
                <a href="https://www.instagram.com/luro.app/" rel="noopener" target="_blank" aria-label="Instagram">
                    <svg aria-hidden="true" focusable="false" width="20" height="20" viewBox="0 0 24 24" role="presentation">
                        <path fill="currentColor" d="M7 3h10a4 4 0 0 1 4 4v10a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V7a4 4 0 0 1 4-4Zm0 2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H7Zm11.25.5a1.25 1.25 0 1 1-2.5 0a1.25 1.25 0 0 1 2.5 0ZM12 8.5A3.5 3.5 0 1 1 8.5 12A3.5 3.5 0 0 1 12 8.5Zm0 2a1.5 1.5 0 1 0 1.5 1.5A1.5 1.5 0 0 0 12 10.5Z"/>
                    </svg>
                </a>
                <span aria-hidden="true">•</span>
                <a href="/privacidade">{{ _('Política de Privacidade') }}</a>
                <span aria-hidden="true">•</span>
                <a href="/termos">{{ _('Termos de Uso') }}</a>
            </div>
        </div>
    </footer>

    <script src="/static/js/theme.js?v={{ ASSETS_VERSION }}" defer></script>
    <script src="/static/js/security.js?v={{ ASSETS_VERSION }}" defer></script>
    <script nonce="{{ request.state.csp_nonce }}">
    // Client-side localized strings for JS to consume (will render translated text)
    window.LURO_I18N = {
        'invalid_balance': "{{ _('Formato de saldo inválido') }}",
        'account_updated': "{{ _('Conta atualizada') }}",
        'save_failed': "{{ _('Falha ao salvar') }}",
        'unable_save_account_prefix': "{{ _('Não foi possível salvar a conta: ') }}",
        'invalid_amount': "{{ _('Valor inválido') }}",
        'transaction_updated': "{{ _('Transação atualizada') }}",
        'unable_save_transaction_prefix': "{{ _('Não foi possível salvar a transação: ') }}",
        'processing_text': "{{ _('Processando...') }}",
        'completed_text': "{{ _('✓ Concluído') }}",
        'in_progress_text': "{{ _('Em andamento') }}",
        'unable_contribute_prefix': "{{ _('Não foi possível contribuir para a meta: ') }}",
        'contribute_fallback_text': "{{ _('Contribuir') }}",
        'confirm_delete_account': "{{ _('Excluir esta conta?') }}",
        'account_deleted': "{{ _('Conta excluída') }}",
        'unable_delete_account_prefix': "{{ _('Não foi possível excluir a conta: ') }}",
        'confirm_delete_transaction': "{{ _('Excluir esta transação?') }}",
        'transaction_deleted': "{{ _('Transação excluída') }}",
        'unable_delete_transaction_prefix': "{{ _('Não foi possível excluir a transação: ') }}"
    };
    </script>
    <script nonce="{{ request.state.csp_nonce }}">
    // Logo redirect: if user is authenticated, send to dashboard instead of home
    (function(){
        try {
            var logo = document.getElementById('site-logo');
            if (!logo) return;
            logo.addEventListener('click', function (ev) {
                var auth = document.body.getAttribute('data-user-authenticated');
                if (auth === 'true') {
                    ev.preventDefault();
                    window.location.href = '/dashboard';
                }
            });
        } catch (e) {
            // noop
        }
    })();
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
